name: éƒ¨ç½² Svelte é¡¹ç›®åˆ° GitHub Pages

# è§¦å‘æ¡ä»¶ï¼šæ¨é€åˆ° main åˆ†æ”¯ï¼ˆæˆ– master åˆ†æ”¯ï¼Œæ ¹æ®ä½ çš„é»˜è®¤åˆ†æ”¯ä¿®æ”¹ï¼‰
on:
  push:
    branches: [ main ]  # è‹¥é»˜è®¤åˆ†æ”¯æ˜¯ masterï¼Œæ”¹ä¸º branches: [ master ]
  # å¯é€‰ï¼šå…è®¸æ‰‹åŠ¨è§¦å‘éƒ¨ç½²
  workflow_dispatch:

# æƒé™é…ç½®ï¼šå…è®¸å†™å…¥ GitHub Pages åˆ†æ”¯ï¼ˆgh-pagesï¼‰
permissions:
  contents: read
  pages: write
  id-token: write

# å·¥ä½œæµä»»åŠ¡
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest  # ä½¿ç”¨ Ubuntu ç¯å¢ƒï¼ˆç¨³å®šä¸”å¸¸ç”¨ï¼‰
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}  # éƒ¨ç½²åè¾“å‡ºè®¿é—®é“¾æ¥

    steps:
      # æ­¥éª¤ 1ï¼šæ‹‰å– GitHub ä»“åº“ä»£ç 
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      # æ­¥éª¤ 2ï¼šè®¾ç½® Node.js ç¯å¢ƒï¼ˆSvelte é¡¹ç›®ä¾èµ– Node.jsï¼‰
      - name: é…ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20  # æ¨èä½¿ç”¨ Node.js 18+ï¼ˆSvelteKit/Vite å…¼å®¹ç‰ˆæœ¬ï¼‰
          cache: 'npm'      # ç¼“å­˜ npm ä¾èµ–ï¼ŒåŠ é€Ÿæ„å»º

      # æ­¥éª¤ 3ï¼šå®‰è£…ä¾èµ–å¹¶æ„å»ºé¡¹ç›®
      - name: å®‰è£…ä¾èµ– & æ„å»º
        run: |
          npm install  
          npm run build  

      # æ­¥éª¤ 4ï¼šå¤„ç† Svelte è·¯ç”±å…¼å®¹ï¼ˆå…³é”®ï¼è§£å†³ GitHub Pages åˆ·æ–° 404 é—®é¢˜ï¼‰
      # åŸç†ï¼šå¤åˆ¶ index.html ä¸º 404.htmlï¼Œè®©æ‰€æœ‰è·¯ç”± fallback åˆ°ä¸»é¡µï¼ˆSPA è·¯ç”±å…¼å®¹ï¼‰
      - name: é…ç½® SPA è·¯ç”±å…¼å®¹
        run: |
          cd dist  
          cp index.html 404.html  

      # æ­¥éª¤ 5ï¼šéƒ¨ç½²åˆ° GitHub Pages
      - name: éƒ¨ç½²
        id: deployment
        uses: actions/deploy-pages@v4
        with:
          # éƒ¨ç½²ç›®å½•ï¼šæŒ‡å®šæ„å»ºåçš„é™æ€æ–‡ä»¶ç›®å½•ï¼ˆå…³é”®ï¼éœ€ä¸é¡¹ç›®è¾“å‡ºç›®å½•åŒ¹é…ï¼‰
          #  éœ€æ ¹æ®ä½ çš„é¡¹ç›®ç±»å‹ä¿®æ”¹ï¼š
          # - ä¼ ç»Ÿ Svelte + Viteï¼šbuildï¼ˆé»˜è®¤ï¼‰
          # - SvelteKitï¼ˆadapter-staticï¼‰ï¼š.svelte-kit/output/static
          # - å…¶ä»–å·¥å…·ï¼šè¯·æŸ¥çœ‹ package.json ä¸­ build è„šæœ¬çš„è¾“å‡ºè·¯å¾„
          folder: build  # ğŸ‘ˆ è¿™é‡Œæ˜¯é»˜è®¤å€¼ï¼Œéœ€æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼
